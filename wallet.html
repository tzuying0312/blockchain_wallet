<!DOCTYPE HTML>
<html>
	<head>
		<title>wallet</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body>
        <header id="header" class="skel-layers-fixed">
            <nav id="nav">
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="reserve.html">Reserve</a></li>
                <li><a href="course.html" >課程專區</a>
                <ul>
                    <li><a href="course_share.html" >我要分享</a></li>
                    <li><a href="course.html" >快速查詢</a></li>
                    <li><a href="course_ask.html" >我要發問</a></li>
                    <li><a href="course_ask.html" >發問區</a></li>
                </ul>
                </li>
                <li><a href="wallet.html">My_wallet</a>
                <ul>
                    <li><a href="wallet.html">交易紀錄</a></li>
                    <li><a href="pay.html">GOPAY</a></li>
                </ul>
                </li>
                <li><a href="setting.html" >個人帳戶</a>
                <ul>
					<li><a href="setting.html" >個人資訊</a>
                    <li><a href="allcard.html" >Card</a></li>
                    <li><a href="index.html">Login</a></li>
                    <li><a href="index.html" id="logout_button">Logout</a></li>
                </ul>
                </li>
            </ul>
            </nav>
        </header>
		<script src="js/req_balance.js"></script>
		<script>
			var name = sessionStorage.getItem("key");
			get_balance_by_user("http://3.87.137.58:8888/get_balance?user="+name)
		</script>
		
	
        <!-- mywallet -->
        <section id="card_one" class="wrapper style special">
            <div class="inner narrow">
                <header>
					<h2 id="username"></h2>
		
                    <div id="balance"></div>
                </header>
                
                <form class="grid-form" method="post" action="#">
                  <div class="feature feature2">
                    <a href="pay.html" style="text-decoration:none;color:gray;">轉帳 </a> 
                  </div>
                  <div class="feature feature2">
                      <p id="clickpay">條碼</p>
                  </div>          
			  	</form>
			  	<h3 id='trans_tilte'>近期交易紀錄</h3>
			  	<form class="grid-form" method="post" action="#">
					<div class="feature feature2">
						<p id="in">進帳</p>
					</div>
					<div class="feature feature2">
						<p id="out">出帳</p>
					</div>          
				</form>
				<!-- trans dib -->
				<form class='trans_form' action="#" id="inrecord">
					<!-- first  -->
					<div class="transaction">
						<div class="icon-type">
							<div class="icon"></div>
						</div>
						<div class="description">
							<div class="info">
								<h3 id="trans_sender1" > </h3>
								<span id="trans_message1"></span>
								-<span id="trans_time1"></span>
							</div>
							<div class="info">
								<h3 id="trans_money1"></h3>
								<span id='status'></span>	
							</div>
						</div>
					</div>
					<!-- second -->
					<div class="transaction">
						<div class="icon-type">
							<div class="icon"></div>
						</div>
						<div class="description">
							<div class="info">
								<h3 id="trans_sender2" > </h3>
								<span id="trans_message2"></span>
								-<span id="trans_time2"></span>
							</div>
							<div class="info">
								<h3 id="trans_money2"></h3>
								<span id='status'></span>	
							</div>
						</div>
					</div>
					<!-- third -->
					<div class="transaction">
						<div class="icon-type">
							<div class="icon"></div>
						</div>
						<div class="description">
							<div class="info">
								<h3 id="trans_sender3" > </h3>
								<span id="trans_message3"></span>
								-<span id="trans_time3"></span>
							</div>
							<div class="info">
								<h3 id="trans_money3"></h3>
								<span id='status'></span>	
							</div>
						</div>
					</div>
				</form>
				<!-- trans dib -->
				<form style='display: none' class='trans_form' action="#" id="outrecord">
					<!-- first  -->
						<div class="transaction">
							<div class="icon-type">
								<div class="icon"></div>
							</div>
							<div class="description">
								<div class="info">
									<h3 id="trans_sender4" > </h3>
									<span id="trans_message4"></span>
									-<span id="trans_time4"></span>
								</div>
								<div class="info">
									<h3 id="trans_money4"></h3>
									<span id='status'></span>		
								</div>
							</div>
					</div>
					<!-- second -->
					<div class="transaction">
						<div class="icon-type">
							<div class="icon"></div>
						</div>
						<div class="description">
							<div class="info">
								<h3 id="trans_sender5" > </h3>
								<span id="trans_message5"></span>
								-<span id="trans_time5"></span>
							</div>
							<div class="info">
								<h3 id="trans_money5"></h3>
								<span id='status'></span>
							</div>
						</div>
					</div>
					<!-- third -->
					<div class="transaction">
						<div class="icon-type">
							<div class="icon"></div>
						</div>
						<div class="description">
							<div class="info">
								<h3 id="trans_sender6" > </h3>
								<span id="trans_message6"></span>
								-<span id="trans_time6"></span>
							</div>
							<div class="info">
								<h3 id="trans_money6"></h3>
								<span id='status'></span>	
							</div>
						</div>
					</div>
        		</form>
        	</div>
		</section>

		<script src="assets/js/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.js"></script>
		
		<script>
			$(document).ready(function(){
				$("#in").click(function(){
					$("#inrecord").fadeIn();
					$("#outrecord").fadeOut();
				});
				$("#out").click(function(){
					$("#outrecord").fadeIn();
					$("#inrecord").fadeOut();
				});
			});
		</script>
		<script> 
			var name = sessionStorage.getItem("key");
			if (name == 'null'){
				alert("請先登入");
				window.location.href="index.html";	
			}
			$('#username').text('Hello,' + sessionStorage.getItem("key"))
			$(document).ready(function(){
				$('#logout_button').click(function(){
				console.log('remove')
				sessionStorage.removeItem("key");
				});
			});
			$.ajax({
				type: "get",
				url: "http://localhost:1993/pay/inrecord/"+sessionStorage.getItem("key"),
				dataType: "json",
				success: function(data){
					if(data.length != 0){
						for ( i=1 ; i < 4 ; i++ ){
							var trans_data = data.pop()
							// $('#trans_sender'+i).text(trans_data['sender'])
							$('#trans_message'+i).text(trans_data['message'])
							$('#trans_time'+i).text(trans_data['paydate']) 
							if(trans_data['cost']== ''){
								$('#trans_sender'+i).text(trans_data['sender'])
								$('#trans_money'+i).text('+ 1 東吳幣') 	
							}
							else{
								$('#trans_sender'+i).text(trans_data['sender'])
								$('#trans_money'+i).text('+ '+trans_data['cost']+' 東吳幣')
							}		
						};
					}
					else{
						console.log('暫無交易資料')
						$('#trans_tilte').text('暫無進帳交易資料')
						document.getElementById('trans_tilte').style.color="red"
					}
					
				},
				error: function (error) {
					alert("Cannot get data");
				}
			});
		</script>
		<script>
			$.ajax({
				type: "get",
				url: "http://localhost:1993/pay/outrecord/"+sessionStorage.getItem("key"),
				dataType: "json",
				success: function(data){
					if(data.length != 0){
						for ( i=1 ; i < 4 ; i++ ){
							var trans_data = data.pop()
							// $('#trans_sender'+i).text(trans_data['sender'])
							$('#trans_message'+(i+3)).text(trans_data['message'])
							$('#trans_time'+(i+3)).text(trans_data['paydate']) 
							if(trans_data['cost']== ''){
								$('#trans_sender'+(i+3)).text(trans_data['receiver'])
								$('#trans_money'+(i+3)).text('- 1 東吳幣') 	
							}
							else{
								$('#trans_money'+(i+3)).text('- '+trans_data['cost']+' 東吳幣')
								$('#trans_sender'+(i+3)).text(trans_data['receiver'])
							}
						};	
					}
					else{
						console.log('暫無交易資料')
						$('#trans_tilte').text('暫無出帳交易資料')
						document.getElementById('trans_tilte').style.color="red"
					}
				},
				error: function (error) {
					alert("Cannot get data");
				}
			});	
		</script>

		<style>
			.trans_form{
			  width: 90%;
			}
			.transaction {
			display: flex;
			flex-wrap: nowrap;
			align-items: center;
			padding: 20px 0;
			}
			.description {
			  display: flex;
			  justify-content: space-between;
			  width: 100%;
			  color: rgb(162, 161, 161);
			}
			.info h3{
			  display: block;
			  width: 100%;
			  margin: 0 0 10px;
			  color: rgb(72, 72, 72);
			  font-size: 18px;
			}
			#nav li {
              display: block;
              float: left;
            }
            #nav li:hover {
                cursor: pointer;
            }
            #nav a:hover {
              /* 滑鼠滑入按鈕變色*/
              background-color: #e9f1f1;
              color: #fff;
            }
            #nav ul li ul {
                visibility: hidden;
				display: none;
                opacity: 0;
            }

            #nav ul li:hover > ul,
            #nav ul li ul:hover {
                visibility: visible;
                opacity: 1;
                display: block;
            }

            #nav ul li ul li {
                clear: both;
                width: 100%;
            }
		</style>
	</body>
</html>